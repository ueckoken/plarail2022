# アーキテクチャ(仮)について

![システム構成図(仮)](./system%20archtecture(draft).jpg)

マイクロサービスアーキテクチャっぽくなっており、それぞれは独立したサービスとして稼働します。

- front
  現在の状態を表示するためのサイト
  また、管理者ページにてポイントの操作が可能
  SkyWayから配信された車載カメラ等の映像を見れる
- external
  frontとWebScoekを介して通信し状態の変更や更新を管理する
  全ての状態はexternal内のKVSにて管理する
    - 状態
      - ポイント・ストップレールの状態
      - 閉塞区間の状態
- internal
  externalと通信して、externalにおいて更新された状態に基づいて指示を行う。
  ESP32に対してサーボの角度を指示する
- ATS
  自動制御をするために、閉塞区間のStateとポイントの状態が与えられた時にその状態に応じたポイントとストップレールの操作を行う
  また、新しくホールセンサの通過を検知するとともに、適切にStateを変更してそれをexternalに対して通知する
- Proxy
  ESP32に搭載されたホールセンサの情報をgRPCを用いてATSのサーバーに対して送信する
- 配信サイト
  カメラの配信をするためのサイト
- 中継サイト
  ESP-EYEから取得した画像データをSkyWayに流すためのページ